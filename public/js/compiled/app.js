function drawRandomGif(){$.getJSON("/api/smashgifs",function(e){console.time("randomSmashGif");var t=e.data,a=!1,o=t.url,s="http://www.reddit.com"+t.permalink,i=t.title,n=t.score;o=o.replace("#",""),seen.length>10&&(seen=[]),-1!=seen.indexOf(o)&&drawRandomGif(),seen.push(o);var r=/((https?:)?\/\/)?(.+?\.)?gfycat\.com\/(.+)/,l=r.exec(o);null==l&&drawRandomGif();var c="<a href='//www.reddit.com/r/smashgifs'>from /r/smashgifs</a>&nbsp;-&nbsp;";c+="<a class='button button-inline button-small button-info' id='drawgif'>&nbsp;<i class='fa fa-random'></i>another?</a><br>";var d="<img class='gfyitem' data-expand=true data-id='"+l[4]+"' />",m="<span class='randGifDesc pull-left'><a href='"+s+"'>"+i+"</a></span><span class='upvotecount pull-right'><small>upvotes: </small>"+n+"</span>";$("#randomSlot").empty(),$("#randomSlot").append("<div class='panel-heading'>"+c+"</div><div class='panel-body'>"+d+"</div><div class='panel-footer'>"+m+"</div>"),a=!0,gfyCollection.init()}).done(function(){console.debug("Successfully grabbed a gif from r/smashbros")}).fail(function(){console.debug("Unable to grab gif from r/smashbros")}).always(function(){console.timeEnd("randomSmashGif")})}$(document).ready(function(){$("#sidebar").affix({offset:{top:100}});var e=$(document.body),t=$(".navbar").outerHeight(!0)+10;e.scrollspy({target:"#leftCol",offset:t})}),function(e,t){function a(e,t,a){var o=e+":",s=document.createElement("test"),i=s.style;return a?i.cssText=o+t:i.cssText=o+["-webkit-","-moz-","-ms-","-o-",""].join(t+";"+o)+t+";",-1!==i[e].indexOf(t)}function o(e){return parseInt(e,10)||0}var s=0,i={classes:{plugin:"fixedsticky",active:"fixedsticky-on",inactive:"fixedsticky-off",clone:"fixedsticky-dummy",withoutFixedFixed:"fixedsticky-withoutfixedfixed"},keys:{offset:"fixedStickyOffset",position:"fixedStickyPosition",id:"fixedStickyId"},tests:{sticky:a("position","sticky"),fixed:a("position","fixed",!0)},getScrollTop:function(){var t="pageYOffset",a="scrollTop";return e?t in e?e[t]:e.document.documentElement[a]:e.document.body[a]},bypass:function(){return i.tests.sticky&&!i.optOut||!i.tests.fixed||e.FixedFixed&&!t(e.document.documentElement).hasClass("fixed-supported")},update:function(e){function a(){var e=p+r;return e>m&&b+v>=e+d}function s(){return m+(d||0)>p+y-l&&p+y-l>=b+(d||0)}if(e.offsetWidth){var n,r,l,c=t(e),d=c.outerHeight(),m=c.data(i.keys.offset),p=i.getScrollTop(),u=c.is("."+i.classes.active),f=function(e){c[e?"addClass":"removeClass"](i.classes.active)[e?"removeClass":"addClass"](i.classes.inactive)},y=t(window).height(),g=c.data(i.keys.position),h=c.parent(),b=h.offset().top,v=h.outerHeight();void 0===m&&(m=c.offset().top,c.data(i.keys.offset,m),c.after(t("<div>").addClass(i.classes.clone).height(d))),g||(n="auto"!==c.css("top")||"auto"!==c.css("bottom"),n||c.css("position","fixed"),g={top:"auto"!==c.css("top"),bottom:"auto"!==c.css("bottom")},n||c.css("position",""),c.data(i.keys.position,g)),r=o(c.css("top")),l=o(c.css("bottom")),g.top&&a()||g.bottom&&s()?u||f(!0):u&&f(!1)}},destroy:function(a){var o=t(a);return i.bypass()?o:o.each(function(){var a=t(this),o=a.data(i.keys.id);t(e).unbind(".fixedsticky"+o),a.removeData([i.keys.offset,i.keys.position,i.keys.id]).removeClass(i.classes.active).removeClass(i.classes.inactive).next("."+i.classes.clone).remove()})},init:function(a){var o=t(a);return i.bypass()?o:o.each(function(){var a=this,n=s++;t(this).data(i.keys.id,n),t(e).bind("scroll.fixedsticky"+n,function(){i.update(a)}).trigger("scroll.fixedsticky"+n),t(e).bind("resize.fixedsticky"+n,function(){o.is("."+i.classes.active)&&i.update(a)})})}};e.FixedSticky=i,t.fn.fixedsticky=function(e){if("function"==typeof i[e])return i[e].call(i,this);if("object"!=typeof e&&e)throw new Error("Method `"+e+"` does not exist on jQuery.fixedsticky");return i.init.call(i,this)},e.FixedFixed||t(e.document.documentElement).addClass(i.classes.withoutFixedFixed)}(window,jQuery);var gfyCollection=function(){function e(e,t){if(t.getElementsByClassName)return t.getElementsByClassName(e);for(var a=[],o=t.getElementsByTagName("*"),s=0;s<o.length;s++)(" "+o[s].className+" ").indexOf(" "+e+" ")>-1&&a.push(o[s]);return a}function t(){elem_coll=e("gfyitem",document);for(var t=0;t<elem_coll.length;t++){var a=new gfyObject(elem_coll[t]);s.push(a)}for(var t=0;t<s.length;t++)null!=s[t]&&s[t].init()}function a(){return s}function o(){s=[],t()}var s=[];return{init:t,get:a,empty:o}}(),gfyObject=function(e){function t(e,t){if(t.getElementsByClassName)return t.getElementsByClassName(e);for(var a=[],o=t.getElementsByTagName("*"),s=0;s<o.length;s++)(" "+o[s].className+" ").indexOf(" "+e+" ")>-1&&a.push(o[s]);return a}function a(){G=document.createElement("div"),G.style.position="absolute";try{G.style.backgroundColor="rgba(0,0,0,0.4)"}catch(e){G.style.backgroundColor="#000";try{G.style.filter="alpha(opacity=60)"}catch(e){}}G.style.color="#fff",G.style.fontFamily="Arial,sans-serif",G.style.fontSize="20px",G.style.padding="10px",G.innerHTML=q.title,G.style.left="0",G.style.top="0",G.style.display="none",P.appendChild(G)}function o(){$=document.createElement("canvas"),$.style.position="absolute",$.style.left="0",$.style.top="0",$.onclick=k,$.onmouseout=R,$.onmouseover=x}function s(){_=document.createElement("video"),_.className="gfyVid",V&&(_.autoplay=!0),_.loop=!0,I?_.controls=!0:_.controls=!1,_.style.width="100%",_.style.height="auto",_.setAttribute("poster","https://thumbs.gfycat.com/"+q.gfyName+"-poster.jpg"),source2=document.createElement("source"),source2.src=gfyWebmUrl,source2.type="video/webm",source2.className="webmsource",_.appendChild(source2),source=document.createElement("source"),source.src=gfyMp4Url,source.type="video/mp4",source.className="mp4source",_.appendChild(source),P.appendChild(_)}function i(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|htc|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function n(){L=document.createElement("img"),L.src=q.gifUrl,j?L.style.width="100%":L.style.maxWidth=q.width+"px",L.style.height="auto",L.onmouseout=R,L.onmouseover=x,P.appendChild(L),P.style.position="relative",P.style.padding=0}function r(){P.style.position="relative",P.style.padding=0,j||(P.style.display="inline-block",P.style.overflow="hidden",P.style.boxSizing="border-box",P.style.MozBoxSizing="border-box",P.style.webkitBoxSizing="border-box")}function l(){J&&(ctrlRow=document.createElement("div"),ctrlRow.style.position="relative",B=document.createElement("div"),B.className="CtrlBox",O=document.createElement("img"),O.className="gfyCtrlPause",O.src="https://assets.gfycat.com/img/placeholder.png",O.style.backgroundImage="url('https://assets.gfycat.com/img/gfycontrols.png')",O.style.cssFloat="right",O.style.marginRight="5px",O.style.width="12px",O.style.height="12px",O.style.borderStyle="none",B.appendChild(O),ctrlReverse=document.createElement("img"),ctrlReverse.className="gfyCtrlReverse",ctrlReverse.src="https://assets.gfycat.com/img/placeholder.png",ctrlReverse.style.backgroundImage="url('https://assets.gfycat.com/img/gfycontrols.png')",ctrlReverse.style.cssFloat="right",ctrlReverse.style.marginRight="5px",ctrlReverse.style.width="14px",ctrlReverse.style.height="12px",ctrlReverse.style.backgroundPosition="-46px 0",ctrlReverse.style.borderStyle="none",U=document.createElement("img"),U.className="gfyCtrlSlower",U.src="https://assets.gfycat.com/img/placeholder.png",U.style.backgroundImage="url('https://assets.gfycat.com/img/gfycontrols.png')",U.style.marginRight="5px",U.style.width="14px",U.style.height="12px",U.style.cssFloat="right",U.style.borderStyle="none",W=document.createElement("img"),W.className="gfyCtrlFaster",W.src="https://assets.gfycat.com/img/placeholder.png",W.style.backgroundImage="url('https://assets.gfycat.com/img/gfycontrols.png')",W.style.width="14px",W.style.height="12px",W.style.cssFloat="right",W.style.marginRight="5px",W.style.borderStyle="none",_.paused?v():w(),B.style.position="relative",B.style.cssFloat="right",B.style.width="100px",B.style.padding="5px",B.style.margin="0",B.setAttribute("id","ctr"+M),O.onclick=k,ctrlReverse.onclick=C,B.appendChild(W),B.appendChild(U),B.appendChild(ctrlReverse),B.appendChild(O),ctrlRow.appendChild(B),P.appendChild(ctrlRow))}function c(){if(null!=P.parentNode&&(I=i(),M=P.getAttribute("data-id"),""!=M)){"true"==P.getAttribute("data-title")&&(A=!0),"true"==P.getAttribute("data-expand")&&(j=!0),"true"==P.getAttribute("data-controls")&&(J=!0),"false"==P.getAttribute("data-autoplay")&&(V=!1);var e=document.createElement("div");attrib_src=P.attributes,attrib_dest=e.attributes;for(var t=0;t<attrib_src.length;t++){var l=attrib_src.item(t),c=l.cloneNode();"style"==c.name&&"null"!=l.value&&attrib_dest.setNamedItem(c)}P.parentNode.replaceChild(e,P),P=e,d("https://gfycat.com/cajax/get/"+M,function(e){if(e){if(q=e.gfyItem,null==q)return;gfyMp4Url=q.mp4Url,gfyMp4Url=gfyMp4Url.replace("http://","https://"),gfyWebmUrl=q.webmUrl,gfyWebmUrl=gfyWebmUrl.replace("http://","https://"),gfyFrameRate=q.frameRate,document.createElement("video").canPlayType?(s(),r(),a(),o(),_.addEventListener?_.addEventListener("loadedmetadata",p,!1):_.attachEvent("onloadedmetadata",p),V&&_.play()):(K=!0,n(),a(),L.onload=function(){var e=navigator.userAgent.toLowerCase();e.indexOf("msie")>-1?G.style.width=L.clientWidth+"px":G.style.width=L.clientWidth-20+"px"}),Q=_.currentTime*gfyFrameRate}})}}function d(e,t,a){var o=Math.floor(1e7*Math.random()+1),s="_"+M+"_"+o++;e+=e.match(/\?/)?"&callback="+s:"?callback="+s;var i=document.createElement("script");i.type="text/javascript",i.src=e,window[s]=function(e){t.call(a||window,e),document.getElementsByTagName("head")[0].removeChild(i),i=null;try{delete window[s]}catch(o){}},document.getElementsByTagName("head")[0].appendChild(i)}function m(){H=_.offsetWidth,D=_.offsetHeight,!j&&H>_.videoWidth&&(H=_.videoWidth,D=_.videoHeight),$.width=H,$.height=D,G.style.width=H-20+"px"}function p(){m(),B||l(),V||I||f()}function u(){var e=$.getContext("2d");H&&e.clearRect(0,0,H,D)}function f(){var e=$.getContext("2d");e.clearRect(0,0,H,D),e.strokeStyle="#ffffff",e.fillStyle="#ffffff",e.lineWidth=5;var t=70,a=80,o=5;(160>D||200>H)&&(a=a*D/240,t=t*D/240,o=3),y(e,[[H/2-t/2,D/2-a/2],[H/2+t/2,D/2],[H/2-t/2,D/2+a/2]],o),e.stroke(),e.fill()}function y(e,t,a){a>0&&(t=h(t,a));var o,s,i=t.length;for(e.beginPath(),o=0;i>o;o++)s=t[o],0==o?e.moveTo(s[0],s[1]):e.lineTo(s[0],s[1]),a>0&&e.quadraticCurveTo(s[2],s[3],s[4],s[5]);e.closePath()}function g(){return Q}function h(e,t){var a,o,s,i,n,r,l,c,d=e.length,m=new Array(d);for(o=0;d>o;o++)a=o-1,s=o+1,0>a&&(a=d-1),s==d&&(s=0),i=e[a],n=e[o],r=e[s],l=b(i[0],i[1],n[0],n[1],t,!1),c=b(n[0],n[1],r[0],r[1],t,!0),m[o]=[l[0],l[1],n[0],n[1],c[0],c[1]];return m}function b(e,t,a,o,s,i){var n=Math.sqrt(Math.pow(a-e,2)+Math.pow(o-t,2)),r=i?s/n:(n-s)/n;return[e+r*(a-e),t+r*(o-t)]}function v(){return J?(O.style.backgroundPosition="-71px 0",U.style.backgroundPosition="0 0",U.style.marginLeft="6px",W.style.backgroundPosition="-192px 0",W.style.width="8px",W.onclick=S,void(U.onclick=T)):void f()}function w(){u(),J&&(O.style.backgroundPosition="-95px 0",W.style.backgroundPosition="-20px 0",U.style.backgroundPosition="-165px 0",W.style.width="14px",U.style.marginLeft="0px",W.onclick=F,U.onclick=E)}function k(){_.paused?(_.play(),w(),Q=N()):(_.pause(),v(),Q=N())}function x(){A&&q.title&&(G.style.display="block")}function R(){A&&(G.style.display="none")}function C(){O.style.backgroundPosition="-95px 0",U.style.backgroundPosition="0 0",U.style.marginLeft="6px",W.style.backgroundPosition="-192px 0",W.style.width="8px",W.onclick=S,U.onclick=T,_.pause();var e=t("mp4source",_)[0],a=t("webmsource",_)[0];Y?(e.src=e.src.replace(/-reverse\.mp4/g,".mp4"),e.src=e.src.replace(/-reverse\.webm/g,".webm"),a.src=a.src.replace(/-reverse\.webm/g,".webm"),ctrlReverse.style.backgroundPosition="-46px 0",Y=!1):(e.src=e.src.replace(/\.mp4/g,"-reverse.mp4"),e.src=e.src.replace(/\.webm/g,"-reverse.webm"),a.src=a.src.replace(/\.webm/g,"-reverse.webm"),ctrlReverse.style.backgroundPosition="-141px 0",Y=!0),_.playbackRate=1,_.load(),_.play()}function E(){_.playbackRate<=1?_.playbackRate=_.playbackRate/2:_.playbackRate--}function F(){_.playbackRate<=1?_.playbackRate=2*_.playbackRate:_.playbackRate++}function N(){return frames=Math.floor(_.currentTime)*gfyFrameRate,remainder=_.currentTime-Math.floor(_.currentTime),remainingFrames=Math.ceil(remainder*gfyFrameRate),frames+=remainingFrames,frames}function S(){if(window.opera){var e=_.onplay;_.onplay=function(){_.pause(),_.onplay=e},_.play()}else _.currentTime+=1/gfyFrameRate,Q=N()}function T(){_.currentTime-=1/gfyFrameRate,Q=N()}function z(){_.load(),_.play()}var P=e;if(null!=P){var M,j,A,B,O,U,W,_,L,$,G,I,q,H,D,Q,M=P.getAttribute("data-id"),J=!0,V=!1,Y=!1,K=!1;return{init:c,refresh:z,id:M,toggle:k,stepForward:S,stepBackward:T,getFrame:g}}};document.addEventListener?document.addEventListener("DOMContentLoaded",gfyCollection.init,!1):document.attachEvent("onreadystatechange",gfyCollection.init);var seen=[],global;$(document).ready(function(){drawRandomGif()}),$(document).on("click","#drawgif",function(e){drawRandomGif()});